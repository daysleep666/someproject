插入缓冲

假设存在这么一张表，一个自增的聚簇索引，一个非唯一的次级索引。

```
CREATE TABLE test (
    id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    num INT NOT NULL,
    INDEX num (num)
)
```

然后插入一百条随机数据

```
INSERT INTO test VALUES (0, RAND() *10000)),(0, RAND() *10000))....(0, RAND() *10000))
```

在插入聚簇索引树时是按照顺序依次插入的，速度非常快，但是对于非聚簇索引树在插入时需要一个一个的查询插入。

    B+树的特性决定了非聚集索引插入的离散性

假设插入一万条数据，就需要在非聚簇索引树查一万次，而如果一个表存在不止一个非聚簇索引，那查询次数就还需要乘以N。这个效率是很差的。

--------

**InsertBuffer**插入缓冲

插入的时候先检查缓冲池中是否存在该页，如果存在就直接修改，如果不存在就插入到InsertBuffer中，然后在按一定策略去合并。

    如果多个插入修改的是同一个索引页，就可以合并插入了。

必须满足两个条件

1. 必须是非唯一的索引。如果是唯一索引还要去索引树里查是不是已经存在了，这样还是要查询定位。
2. 必须是非聚簇索引