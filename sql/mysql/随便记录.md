# mysql体系结构和存储引擎

mysql配置文件位置 /etc/my.cnf

### **InnoDB引擎**

InnoDB是多线程模型

**1.Master Thread**

将缓冲池中的数据异步刷新到磁盘,保证数据的一致性。

**2. IO Thread**

- write IO Thread
- read IO Thread
- insert buffer IO Thread
- log IO Thread

执行语句|
:--|
SHOW VARIABLES LIKE 'innodb_%io_threads';|
+-------------------------+-------+<br>\|Variable_name&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;\|Value&ensp;&ensp;\|<br>+-------------------------+-------+<br>\|innodb_read_io_threads&ensp;&ensp;\|4&ensp;&ensp;&ensp;&ensp;&ensp;\|<br>\|innodb_read_io_threads&ensp;&ensp;\|4&ensp;&ensp;&ensp;&ensp;&ensp;\|<br>+-------------------------+-------+<br>|

### 缓冲池

InnoDB是将数据按页的形式存储在磁盘上。

读取:读取页时先查缓冲池，若命中,直接返回,否则从磁盘上读取该页,并将该页加到缓冲池中。

更新:先修改缓冲池中的页,然后以Checkpoint机制刷新回磁盘。

 执行语句|
:--|
SHOW VARIABLES LIKE 'innodb_%io_threads';|
+-------------------------+-------+<br>\|Variable_name&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;\|Value&ensp;&ensp;\|<br>+-------------------------+-------+<br>\|innodb_buffer_pool_size&ensp;\|134217728\||

我本地的缓冲池大小大概是0.12G左右。

缓冲池包括:数据页(data page),插入缓冲(insert buffer),锁信息(lock info),索引页(index page),自适应索引哈希(adaptive hash index),数据字典信息(data dictionary)

若有多个缓冲池实例,数据页会根据哈希值分配到不同的缓冲池里。

 执行语句|
:--|
SHOW VARIABLES LIKE 'innodb_buffer_pool_instances';|
+-------------------------+-------+<br>\|Variable_name&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;\|Value&ensp;&ensp;\|<br>+-------------------------+-------+<br>\|innodb_buffer_pool_instances&ensp;\|1\||

缓冲池中页的大小默认为16kb,使用LRU算法对缓冲池管理。